#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>

&mt {
  tapping-term-ms = <201>;
  flavor = "tap-preferred";
};
&sk {
  release-after-ms = <2000>;
  quick-release;
};

#define ALPHA 0
#define SYM 1
#define NUM 2
#define SYS 3

/ {

  //  0  1  2  3  4   5  6  7  8  9
  // 10 11 12 13 14  15 16 17 18 19
  // 20 21 22 23 24  25 26 27 28 29
  // 30 xx 31 32 33  34 35 36 xx 37
  combos {
    compatible = "zmk,combos";
    combo_sys {
      timeout-ms = <30>;
      key-positions = <6 7 8>;
      bindings = <&to SYS>;
    };
    combo_caps {
      timeout-ms = <30>;
      key-positions = <16 17 18>;
      bindings = <&caps_word>;
    };
  };

  behaviors {
    hm_l: homerow_mods_left {
      compatible = "zmk,behavior-hold-tap";
      label = "HOMEROW_MODS_L";
      #binding-cells = <2>;
      tapping-term-ms = <300>;
      quick-tap-ms = <250>;
      flavor = "tap-preferred";
      bindings = <&kp>, <&kp>;
    };
    hm_r: homerow_mods_right {
      compatible = "zmk,behavior-hold-tap";
      label = "HOMEROW_MODS_R";
      #binding-cells = <2>;
      tapping-term-ms = <300>;
      quick-tap-ms = <250>;
      flavor = "tap-preferred";
      bindings = <&kp>, <&kp>;
    };
    hl_l: homerow_layers_left {
      compatible = "zmk,behavior-hold-tap";
      label = "HOMEROW_LAYERS_L";
      #binding-cells = <2>;
      tapping-term-ms = <220>;
      quick-tap-ms = <250>;
      flavor = "tap-preferred";
      bindings = <&mo>, <&kp>;
    };
    hl_r: homerow_layers_right {
      compatible = "zmk,behavior-hold-tap";
      label = "HOMEROW_LAYERS_R";
      #binding-cells = <2>;
      tapping-term-ms = <220>;
      quick-tap-ms = <250>;
      flavor = "tap-preferred";
      bindings = <&mo>, <&kp>;
    };
    td: tapdance {
      compatible = "zmk,behavior-hold-tap";
      label = "TAPDANCE";
      #binding-cells = <2>;
      tapping-term-ms = <190>;
      quick-tap-ms = <250>;
      flavor = "tap-preferred";
      bindings = <&kp>, <&kp>;
    };
  };

  keymap {
    compatible = "zmk,keymap";
    alpha {
      bindings = <
        &kp B &hm_l LCTRL L &hm_l LALT D &hm_l LCMD C &kp J &kp Z &hm_r RCMD Y &hm_r RALT O &hm_r RCTRL U &kp COMMA
        &hl_l NUM N &kp R &hl_l SYM T &hl_l SYS S &kp V &kp P &hl_r SYS H &hl_r SYM A &kp E &hl_r NUM I
        &kp Q &kp X &kp M &kp W &kp G &kp K &kp F &kp UNDER &kp COLON &kp DOT
        &none &none &key_repeat &sk LSHFT &kp LC(LS(LALT)) &kp SPACE &kp RCMD &none
      >;
    };
    sym {
      bindings = <
        &kp GRAVE &kp LT &kp GT &kp MINUS &kp PIPE &kp CARET &kp LBRC &kp RBRC &kp DOLLAR &kp QMARK
        &kp EXCL &kp ASTRK &kp SLASH &kp EQUAL &kp AMPS &kp HASH &kp LPAR &kp RPAR &kp SEMI &kp DQT
        &kp TILDE &kp PLUS &kp LBKT &kp RBKT &kp PERCENT &kp AT &kp COLON &kp BACKSLASH &kp DOT &kp SQT
        &trans &trans &trans &trans &trans &trans &trans &trans
      >;
    };
    num {
      bindings = <
        &trans &kp COMMA &kp N9 &kp N7 &trans &trans &kp N6 &kp N8 &kp DOT &trans
        &none &kp N5 &kp N3 &kp N1 &trans &trans &kp N0 &kp N2 &kp N4 &none
        &trans &trans &trans &trans &trans &trans &trans &trans &trans &trans
        &trans &trans &trans &trans &trans &trans &trans &trans
      >;
    };
    sys {
      bindings = <
        &kp GRAVE &kp ESC &kp LC(LS(TAB)) &kp RC(TAB) &trans &trans &td LG(V) LG(C) &kp UP &td Q BSPC &trans
        &kp TAB &kp DEL &kp HOME &kp END &trans &trans &td TAB LEFT &kp DOWN &kp RIGHT &kp ENTER
        &trans &trans &kp LG(LBKT) &kp LG(RBKT) &trans &trans &kp LC(LG(LS(N4))) &kp PG_UP &kp PG_DN &trans
        &trans &trans &to ALPHA &trans &none &kp LCMD &trans &trans
      >;
    };
  };
};
